FROM python:3.12-slim

WORKDIR /espresso

COPY . .
RUN rm -r app/web app/slack
RUN pip install -r requirements-api.txt
RUN pip install -r pybeansack/requirements.txt

ENV SENTENCE_TRANSFORMERS_HOME=.models
ENV EMBEDDER_MODEL=avsolatorio/GIST-small-Embedding-v0
ENV EMBEDDER_CTX=512

EXPOSE 8080
CMD ["fastapi", "run", "app/apirouter.py", "--port", "8080", "--host", "0.0.0.0"]